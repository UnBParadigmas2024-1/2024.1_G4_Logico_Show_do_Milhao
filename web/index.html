<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show do Milhão</title>
    <link rel="stylesheet" href="custom.css" />
</head>

<body>
    <h1 class="menu-topo">Grupo 4</h1>
    <h2 class="menu-topo">Apresenta</h2>
    <img src="show.png" id='logo-milhao' alt="Jogo show do Milhão">
    <div class="start-container">
        <div id="status">Clique no botão para iniciar o jogo</div>
        <button id="start-button" class="idle-button" onclick="startGame()">Iniciar Jogo</button>
    </div>
    <div class="question" id="question" style="display:none;"></div>
    <ul class="options" id="options" style="display:none;"></ul>
    <div id="valor-acumulado" style="display:none;">Valor Acumulado: R$ 0,00</div>

    <div class="button-container" style="display:none;" id="button-container">
        <button id="hint-button" class="helpIdle-button" onclick="getHint()">Dica</button>
        <button id="next-button" class="helpIdle-button" onclick="getQuestion()" style="display:none;">Próxima Pergunta</button>
        <button id="desistir-button" class="helpIdle-button" onclick="desistir()">Desistir</button>
        <button id="skip-button" class="helpIdle-button" onclick="skipQuestion()">Pular</button>
        <button id="help-button" class="helpIdle-button" onclick="getHelp()" style="display:none;">Ajuda</button>
    </div>

    <script>
        let valorAcumulado = 0;
        let currentQuestionNumber = 0;
        let skipUsed = false;

        function startGame() {
            fetch('/api/iniciar')
                .then(response => response.json())
                .then(data => {
                    document.querySelectorAll('.menu-topo').forEach(function(menu) {
                        menu.style.display = 'none';
                    });
                    document.getElementById('logo-milhao').style = 'width:15.625rem;';
                    document.getElementById('status').textContent = data.status;
                    document.getElementById('start-button').style.display = 'none';
                    getQuestion();
                    document.getElementById('button-container').style.display = 'flex';
                    document.getElementById('valor-acumulado').style.display = 'block';
                    document.getElementById('help-button').style.display = 'block';
                })
                .catch(error => console.error('Erro:', error));
        }

        function getQuestion() {
            fetch('/api/pergunta')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'Fim de jogo') {
                        document.getElementById('status').textContent = 'Fim de jogo! Pontuação: ' + data.pontuacao + ' | Valor Acumulado: R$ ' + data.valor_acumulado;
                        document.getElementById('question').style.display = 'none';
                        document.getElementById('options').style.display = 'none';
                        document.getElementById('button-container').style.display = 'none';
                    } else {
                        if (data.especial) {
                            if (confirm("Você deseja desistir e levar o valor acumulado e um carro?")) {
                                desistir();
                                return;
                            }
                        }
                        currentQuestionNumber = data.numero;
                        document.getElementById('question').textContent = data.pergunta;
                        document.getElementById('question').style.display = 'block';
                        const optionsList = document.getElementById('options');
                        optionsList.innerHTML = '';
                        data.alternativas.forEach((option, index) => {
                            const li = document.createElement('li');
                            const button = document.createElement('button');
                            button.classList.add('option-button');
                            button.textContent = option;
                            button.onclick = () => sendAnswer(data.numero, option.charAt(0));
                            li.appendChild(button);
                            optionsList.appendChild(li);
                        });
                        optionsList.style.display = 'block';
                        document.getElementById('next-button').style.display = 'none';
                        document.getElementById('hint-button').style.display = 'block';
                        if (!skipUsed) {
                            document.getElementById('skip-button').style.display = 'block';
                        }
                    }
                })
                .catch(error => console.error('Erro:', error));
        }

        function sendAnswer(numero, resposta) {
            console.log("Enviando resposta:", { numero: numero, resposta: resposta });
            fetch('/api/resposta', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ numero: numero, resposta: resposta })
            })
                .then(response => response.json())
                .then(data => {
                    console.log("Resposta do servidor:", data);
                    document.getElementById('status').textContent = data.status;
                    if (data.status === 'Correto') {
                        valorAcumulado = data.valor_acumulado;
                        document.getElementById('valor-acumulado').textContent = 'Valor Acumulado: R$ ' + valorAcumulado.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        getQuestion();
                    } else {
                        document.getElementById('status').textContent += ' A resposta correta é ' + data.resposta_correta;
                        alert("FIM DE JOGO,você vai voltar para casa de bolsos vazios! Resposta errada! A resposta correta é: " + data.resposta_correta);
                        location.reload();
                    }
                })
                .catch(error => console.error('Erro:', error));
        }


        function skipQuestion() {
            fetch('/api/pular')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('status').textContent = 'Questão pulada!';
                    valorAcumulado += 65000;
                    document.getElementById('valor-acumulado').textContent = 'Valor Acumulado: R$ ' + valorAcumulado.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    skipUsed = true;
                    document.getElementById('skip-button').style.display = 'none';
                    getQuestion();
                })
                .catch(error => console.error('Erro:', error));
        }

        function getHint() {
            fetch('/api/dica', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ numero: currentQuestionNumber })
            })
                .then(response => response.json())
                .then(data => {
                    alert(data.dica);
                })
                .catch(error => console.error('Erro:', error));
        }

        function getHelp() {
            fetch('/api/ajuda')
                .then(response => response.json())
                .then(data => {
                    alert(data.mensagem);
                })
                .catch(error => console.error('Erro:', error));
        }

        function desistir() {
            fetch('/api/desistir')
                .then(response => response.json())
                .then(data => {
                    alert("Você desistiu do jogo! Valor recebido: R$ " + data.valor.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " e um carro!");
                    location.reload();
                })
                .catch(error => console.error('Erro:', error));
        }
    </script>
</body>

</html>

